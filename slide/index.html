<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Data Visualization</title>
<!--<link href='http://fonts.googleapis.com/css?family=Lora' rel='stylesheet' type='text/css'>-->
<link href='http://fonts.googleapis.com/css?family=PT+Sans' rel='stylesheet' type='text/css'>

<!-- Included CSS Files (Compressed) -->
  <link rel="stylesheet" href="../foundation/css/foundation.min.css">

  <link href="style.css" rel="stylesheet" type="text/css" />

<script src="js/jquery-1.8.2.min.js"></script>
<script src="js/jquery.scrollTo-1.4.3.1.min.js"></script>
<script type="text/javascript" src="scripts/jquery.parallax-1.1.js"></script>
<script src="js/jquery.easing.1.3.js"></script>
<script src="js/jquery.scrollorama.js"></script>
<script src="js/jquery.scrolldeck.js"></script>
<script src="js/waypoints.min.js"></script>

  <script type="text/javascript" src="../d3.v2.js"></script>



  <script src="../foundation/js/modernizr.foundation.js"></script>

  <!-- IE Fix for HTML5 Tags -->
  <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

<script type="text/javascript">
$(document).ready(function(){
	//$('#nav').localScroll(800);
	
	// var scrollorama = $.scrollorama({
 //        blocks:'.slide'
 //    });
 //    scrollorama.animate('#parallaxTitle',{ delay: 0, duration: 500, property:'top', start:20, end:800 });
 //    scrollorama.animate('#parallaxTitle',{ delay: 0, duration: 500, property:'opacity', end:0 });


	RepositionNav();
	
	$(window).resize(function(){
		RepositionNav();
	});	
	
	//.parallax(xPosition, adjuster, inertia, outerHeight) options:
	//xPosition - Horizontal position of the element
	//adjuster - y position to start from
	//inertia - speed to move relative to vertical scroll. Example: 0.1 is one tenth the speed of scrolling, 2 is twice the speed of scrolling
	//outerHeight (true/false) - Whether or not jQuery should use it's outerHeight option to determine when a section is in the viewport

	$('#intro').parallax("50%", 0, 0.1, true);
	$('#world').parallax("50%", 200, 0.1, true);
	$('#japan').parallax("50%", 700, 0.1, true);
	$('#thailand').parallax("50%", 2750, 0.3, true);

	var deck = new $.scrolldeck({
		slides: '.slide',
		buttons: '#nav li a',
		easing: 'easeInOutExpo'
	});


 	loadWordMap();
 	renderJapanMap();
	renderThailandMap();
 	loadSFmap();

    $('#thailand').waypoint(function() {
 
	console.log("you hit thailand");
	populateThailandDensity();
  });
})
</script>
</head>

<body>
	<ul id="nav">
		<li><a href="#intro" title="Next Section"></a></li>
		 <li><a href="#world" title="Next Section"></a></li>
	    <li><a href="#japan" title="Next Section"></a></li>
	    <li><a href="#thailand" title="Next Section"></a></li>
	   <li><a href="#sf" title="Next Section"></a></li>
	</ul>
	
	<div id="intro" class="slide">
		
		<div  class="story">
		
			<div  class="bigtitle"><h1>Data Visualization.</h1></div>
			<p>Data visualization is the study of the visual representation of data, meaning "information that has been abstracted in some schematic form, including attributes or variables for the units of information" - <a href="http://www.math.yorku.ca/SCS/Gallery/milestone/milestone.pdf">Michael Friendly.</a></p>
			<p>Use keyboard ↓ and ↑ to scroll through this story.</p>
			
		 </div> <!-- .six columns -->
		
		</div> <!--.story-->

		
		
	</div> <!--#intro-->
	<div id="world" class="slide">
		<div  class="story">
			<div class="bigtitle"><h1>World</h1></div>
			<div id="subtitle">World is a common name for the whole of human civilization, specifically human experience, history, or the human condition in general, worldwide, i.e. anywhere on Earth.</div>
	
			<div id="worldmap" class="worldmap" ></div>
		</div> <!--.story-->
	</div> <!-- world -->

	<div id="japan" class="slide">
		
		<div class="row">
			
		<div id="map" class="map" ></div>
		</div><!--#row-->

		<div class="row">
		<div  class="story">

	    	<div class="six columns">
			<!-- <span class="or-block animate-in" data-build="1" data-animation="fly-in-left"> --><div class="bigtitle"><h1>Japan</h1></div><!-- </span> -->
	        <p >Japan i/dʒəˈpæn/ (Japanese: 日本 Nihon or Nippon; formally 日本国  Nippon-koku or Nihon-koku, literally "[the] State of Japan") is an island nation in East Asia. Located in the Pacific Ocean, it lies to the east of the Sea of Japan, China, North Korea, South Korea and Russia, stretching from the Sea of Okhotsk in the north to the East China Sea and Taiwan in the south. The characters that make up Japan's name mean "sun-origin", which is why Japan is sometimes referred to as the "Land of the Rising Sun".</p>
	        </div>
			
	    </div> <!--.story-->
		</div><!--#row-->
		

	</div> <!--#second-->
	
	<div id="thailand" class="slide">
		  
		<div class="story">
			<span class="or-block animate-in">
			<div id="thailandmap" class="thailandmap" ></div>
			</span>

			 <div class="row">
			<div class="six columns">
				
			</div>
			   <div class="one columns"></div>
	    	<div class="five columns">
			<span class="or-block animate-in" data-build="1" data-animation="fly-in-left"><div class="bigtitle"><h1>Thailand</h1></div></span>
	        <p class="or-block animate-in" data-build="2" data-animation="fly-in-right">Thailand ( /ˈtaɪlænd/ ty-land or /ˈtaɪlənd/ ty-lənd;[8] Thai: ประเทศไทย, RTGS: Prathet Thai), officially the Kingdom of Thailand (Thai: ราชอาณาจักรไทย, RTGS: Ratcha Anachak Thai; IPA: [râːt.tɕʰā ʔāːnāːtɕàk tʰāj] ( listen)), formerly known as Siam (Thai: สยาม; RTGS: Sayam), is a country located at the centre of the Indochina peninsula in Southeast Asia. It is bordered to the north by Burma and Laos, to the east by Laos and Cambodia, to the south by the Gulf of Thailand and Malaysia, and to the west by the Andaman Sea and the southern extremity of Burma. Its maritime boundaries include Vietnam in the Gulf of Thailand to the southeast, and Indonesia and India in the Andaman Sea to the southwest.</p>
	        <p>Population per sqkm.</p>
	        <p>Data from <a href="http://maps.worldbank.org/overlays/4242" target="_blank">Worldbank.org</a></p>
	        </div>
	     
	         </div><!--#row-->
	    </div> <!--.story-->
	   
	   <!--  <div class="row">
			<span class="or-block animate-in">
			<div id="thailandmap" class="thailandmap" ></div>
			</span>
		</div><!--#row--> -->
	</div> <!--#third-->
	
	<div id="sf" class="slide">
		  
		<div class="story">
			<div class="row">
			<div class="four columns"></div>
			<div class="eight columns"><span class="or-block animate-in" data-build="1" data-animation="fly-in-left"><div class="bigtitle"><h1>United States</h1></div></span>
			<span class="or-block animate-in" data-build="2"><p>The United States of America (commonly called the United States, the U.S., the USA, America, and the States) is a federal constitutional republic consisting of fifty states and a federal district.
			</p></span>
		</div>
</div> <!-- row -->
			<span class="or-block animate-in" data-build="3"><div id="sfmap" class="sfmap" ></div></span>
		</div> <!--.story-->
	</div> <!--#sf-->

 <script>



function renderThailandMap(){

var pinSriracha;

 var width = 900,
    height = 1000,
    centered;

 	var svg = d3.select(".thailandmap").append("svg")
    .attr("width", width)
    .attr("height", height);
    //.attr("id", "thailand");
  	var thailandxym = d3.geo.albers();
    var thailandpath = d3.geo.path().projection(thailandxym);

    thailandxym.origin([100.931293,13.191816])
    thailandxym.translate([200, 390])
    thailandxym.parallels([24.6, 43.6])
    thailandxym.scale(3000);

	var provinceColor="#ddd";
	var mouseOverColor="#0B4199";
	var tooltip;


	function tooltipName(text,pos){

		tooltip = d3.select("body")
		.append("div")
		.attr("class","alert-box")
		.style("position", "absolute")
		.style("z-index", "10")
		.style("visibility", "hidden")
		.text(text);
	}


	function animateDrop(){
	pinSriracha=svg.selectAll(".pinSriracha");
					pinSriracha
			 		.transition()
			 		.delay(0)
			 		.ease("linear")
			 		.duration(450)
	 				.attr("transform", "translate(" + (thailandxym(thailandxym.origin())[0]-22) +"," + (thailandxym(thailandxym.origin())[1]-30) + ")")
	 				.each("end",animateLift);
	}

	function animateLift(){
	pinSriracha=svg.selectAll(".pinSriracha");
			pinSriracha
			.transition()
			.delay(0)
			.ease("linear")
			.duration(500)
			.attr("transform", "translate(" + (thailandxym(thailandxym.origin())[0]-22) +"," + (thailandxym(thailandxym.origin())[1]-40) + ")")
			.each("end",animateDrop);

	}
	
 	d3.json("../thailandwithdensity.json", function(data) {


        svg.selectAll("path").data(data.features)
        .enter().append("path")
        .attr("d", thailandpath)
        .attr("class","province")
        .attr("density",function(p){return p.properties.p})
        .attr("id",function(p){
			return p.properties.name.replace(" ","");
        })
		.style("fill", function(p) { 
			//I am going to fill the color when user scrolls to Thailand slide .
			//console.log(p.properties.p);
			//return getColor(p.properties.p);

			// if (p.properties.name.toLowerCase()=="ChonBuri".toLowerCase())
			// 	return mouseOverColor;
			// else
        		return provinceColor 


        })
        .on("mouseover", function(e){
        	//d3.select(this).style("fill", mouseOverColor)
			//console.log(d3.mouse(this));
			var mousePos=d3.mouse(this);

        	tooltipName(e.properties.name + "\n" + e.properties.p,mousePos);
			tooltip.style("visibility", "visible");
		
        })
        .on("mouseout", function(e){

        	//d3.select(this).style("fill", e.properties.name=="ChonBuri"?mouseOverColor:provinceColor)
        	tooltip.style("visibility", "hidden");
        })
        .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");});
       
	

		svg.append("svg:image")
            .attr("class","pinSriracha")
            .attr("transform", "translate(" + (thailandxym(thailandxym.origin())[0]-22) +"," + (thailandxym(thailandxym.origin())[1]-500) + ")")
            .attr("width", 44)
     		.attr("height", 44)
            .attr("xlink:href", "images/pinThailand.png")
            .transition()
            .delay(0)
            .duration(400)
            .ease("sin")
            .attr("transform", "translate(" + (thailandxym(thailandxym.origin())[0]-22) +"," + (thailandxym(thailandxym.origin())[1]-30) + ")")
        .each("end",animateLift);

 	});
		 





 }
	
 	function populateThailandDensity(){

 		function getColor(d) {
	    return d > 1000 ? 'rgb(8,48,107)' :
	           d > 500  ? 'rgb(8,81,156)' :
	           d > 200  ? 'rgb(33,113,181)' :
	           d > 100  ? 'rgb(66,146,198)' :
	           d > 50   ? 'rgb(107,174,214)' :
	           d > 20   ? 'rgb(158,202,225)' :
	           d > 10   ? 'rgb(198,219,239)' :
	                      'rgb(222,235,247)';
		}	
		
      	   	var svg = d3.select(".thailandmap").select("svg")
      	   	.selectAll("path").transition().delay( function( d, i ) { return 50 * i; } ).style("fill",function(p){

      	   			var density =d3.select(this).attr("density");
      	   			return getColor(density);
      	   	});
	};

function renderJapanMap(){



 var width = 900,
    height = 1000,
    centered;


var pinKanagawa;





    var svg = d3.select(".map").append("svg")
    .attr("width", width)
    .attr("height", height)
   

  

    var xym = d3.geo.albers();
    var path = d3.geo.path().projection(xym);

    xym.origin([139.334468,35.580826])
    xym.translate([700, 550])
    xym.parallels([24.6, 43.6])
    xym.scale(3000);

   


var provinceColor="#ddd";
var mouseOverColor="red";

		

       d3.json("../japan.json", function(data) {

        svg.selectAll("path").data(data.features)
        .enter().append("path")
        .attr("d", path)
        .attr("class","province")
        .attr("id",function(p){
			return p.properties.name;
        })
        .style("fill", function(p) { 
			if (p.properties.name=="Kanagawa")
				return mouseOverColor;
			else
        		return provinceColor 
        })
        .on("mouseover", function(e){
        	d3.select(this).style("fill", mouseOverColor)
			//console.log(d3.mouse(this));
			var mousePos=d3.mouse(this);

        	tooltipName(e.properties.name,mousePos);
			tooltip.style("visibility", "visible");
        })
        .on("mouseout", function(e){

        	d3.select(this).style("fill", e.properties.name=="Kanagawa"?mouseOverColor:provinceColor)
        	tooltip.style("visibility", "hidden");
        })
        .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");});
       
	
      


    svg.append("text")
            .attr("class","alert-box alert")
            .style("opacity",0)
             .attr("transform", "translate(" + (xym(xym.origin())[0]+20) +"," + (xym(xym.origin())[1]+10) + ")")
            .text("Kanagawa")
            .transition()
            .duration(1000)
            .delay(200)
            .style("opacity",1);

 	svg.append("svg:image")
            .attr("class","pin")
            .attr("transform", "translate(" + (xym(xym.origin())[0]-22) +"," + (xym(xym.origin())[1]-500) + ")")
            .attr("width", 44)
     		.attr("height", 44)
            .attr("xlink:href", "images/pinJapan.png")
            .transition()
            .delay(0)
            .duration(400)
            .ease("sin")
            .attr("transform", "translate(" + (xym(xym.origin())[0]-22) +"," + (xym(xym.origin())[1]-30) + ")")
            .each("end",animateLift);


      });
var tooltip;


function tooltipName(text,pos){

	tooltip = d3.select("body")
	.append("div")
	.attr("class","alert-box alert")
	.style("position", "absolute")
	.style("z-index", "10")
	.style("visibility", "hidden")
	.text(text);
}

function animateDrop(){
pinKanagawa=svg.selectAll(".pin");
				pinKanagawa
		 		.transition()
		 		.delay(0)
		 		.ease("linear")
		 		.duration(450)
 				.attr("transform", "translate(" + (xym(xym.origin())[0]-22) +"," + (xym(xym.origin())[1]-30) + ")")
 				.each("end",animateLift);
}

function animateLift(){
pinKanagawa=svg.selectAll(".pin");
		pinKanagawa
		.transition()
		.delay(0)
		.ease("linear")
		.duration(500)
		.attr("transform", "translate(" + (xym(xym.origin())[0]-22) +"," + (xym(xym.origin())[1]-40) + ")")
		.each("end",animateDrop);

}


}


function loadWordMap(){


 	var width = 700,
    height = 700,
    centered;
    var plainColor="#ddd";
	var mouseOverColor="red";

    var svg = d3.select(".worldmap").append("svg")
    .attr("width", width)
    .attr("height", height)
    .on('mousedown', mousedown);
   
	var projection=d3.geo.azimuthal();
	projection
	.mode("orthographic")
	.origin([139.334468,35.580826])
	.scale(300).translate([350,330]);

	var circle = d3.geo.greatCircle()
    .origin(projection.origin());

// TODO fix d3.geo.azimuthal to be consistent with scale
var scale = {
  orthographic: 380,
  stereographic: 380,
  gnomonic: 380,
  equidistant: 380 / Math.PI * 2,
  equalarea: 380 / Math.SQRT2
};



  	var path=d3.geo.path().projection(projection);

	d3.json("../world-countries.json", function(collection) {
		  	feature=d3.select("svg").selectAll("path")
		    .data(collection.features)
		   	.enter().append("path")
		    .attr("d", path)
		    .attr("id",function(p){
					return p.id;
		    })
		    .style("fill", function(p) { 
					if (p.properties.name=="Japan" || p.properties.name=="Thailand" || p.id=="USA")
						return mouseOverColor;
					else
		        		return plainColor 
		     })
		    .on("mouseover", function(e){
		        	d3.select(this).style("fill", mouseOverColor)
					var mousePos=d3.mouse(this);

		        	tooltipName(e.properties.name,mousePos);
					tooltip.style("visibility", "visible");
					
		    })
		    .on("mouseout", function(e){

		        	d3.select(this).style("fill", e.properties.name=="Kanagawa"?mouseOverColor:plainColor)
		        	tooltip.style("visibility", "hidden");
		    })
		    .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");});
	startAnimation();	
});




function startAnimation() {
  done = false;
  d3.timer(function() {
    var origin = projection.origin();
   origin =[origin[0] +0.16, origin[1] ];
    projection.origin(origin);
    circle.origin(origin);
    refresh();


  });
}


//d3.timer(move(),1000);

d3.select(window).on('mousemove', mousemove)
                 .on('mouseup', mouseup);
var m0,
    o0;

function mousedown() {
  m0 = [d3.event.pageX, d3.event.pageY];

  o0 = projection.origin();
  d3.event.preventDefault();

}



function mousemove() {
  if (m0) {
    var m1 = [d3.event.pageX, d3.event.pageY],
        o1 = [o0[0] + (m0[0] - m1[0]) / 8, o0[1] + (m1[1] - m0[1]) / 8];
    projection.origin(o1);
    circle.origin(o1)
    refresh();
  }
}

function mouseup() {
  if (m0) {
    mousemove();
    m0 = null;
  }
}

function refresh(duration) {
  (duration ? feature.transition().duration(duration) : feature).attr("d", clip);
}

function clip(d) {
  return path(circle.clip(d));
}


var tooltip;
function tooltipName(text,pos){

	tooltip = d3.select("body")
	.append("div")
	.attr("class","alert-box alert")
	.style("position", "absolute")
	.style("z-index", "10")
	.style("visibility", "hidden")
	.text(text);
}





}

function loadSFmap(){


 var width = 1400,
    height = 1000,
    centered;

    var svg = d3.select("#sfmap").append("svg")
    .attr("width", width)
    .attr("height", height);
   

 
    var projection = d3.geo.albers().scale(width)
    .translate([-100, 100]);

    projection.origin([-122.4183,37.7750])
    projection.scale(900);

    var path = d3.geo.path().projection(projection);

   

   


	var provinceColor="#ddd";
	var mouseOverColor="red";

	svg.append("rect")
    .attr("class", "background")
    .style("fill","transparent")
    .attr("width", width)
    .attr("height", height)
    .on("click", click);

	var g = svg.append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")")
  	.append("g")
    .attr("id", "states");


    d3.json("../us-counties.json", function(data) {

        g.selectAll("path").data(data.features)
        .enter().append("path")
        .attr("d", path)
        .style("fill", function(p) { 
        		return provinceColor 
        })
        .on("mouseover", function(e){
        	d3.select(this).style("fill", mouseOverColor)
			var mousePos=d3.mouse(this);
        	tooltipName(e.properties.name,mousePos);
			tooltip.style("visibility", "visible");
        })
        .on("mouseout", function(e){
        	d3.select(this).style("fill", provinceColor);
        	tooltip.style("visibility", "hidden");
        })
        .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
        .on("click", click); //when click on path call click;
       
	
      


  //   svg.append("text")
  //           .attr("class","alert-box alert")
  //           .style("opacity",0)
  //            .attr("transform", "translate(" + (projection(projection.origin())[0]+20) +"," + (projection(projection.origin())[1]+10) + ")")
  //           .text("San Francisco")
  //           .transition()
  //           .duration(1000)
  //           .delay(200)
  //           .style("opacity",1);

 	// svg.append("svg:image")
  //           .attr("class","pin")
  //           .attr("transform", "translate(" + (projection(projection.origin())[0]-22) +"," + (projection(projection.origin())[1]-500) + ")")
  //           .attr("width", 44)
  //    		.attr("height", 44)
  //           .attr("xlink:href", "images/pingoogle.png")
  //           .transition()
  //           .delay(0)
  //           .duration(400)
  //           .ease("sin")
  //           .attr("transform", "translate(" + (projection(projection.origin())[0]-22) +"," + (projection(projection.origin())[1]-30) + ")")
  //           .each("end",animateLift);


    });
	
	function click(d) {
	
	  var x = 0,
	      y = 0,
	      k = 1;

	  if (d && centered !== d) {
	    var centroid = path.centroid(d);
	    x = -centroid[0];
	    y = -centroid[1];
	    k = 4;
	    centered = d;
	  } else {
	    centered = null;
	  }
		

	  g.selectAll("path")
	      .classed("active", centered && function(d) { return d === centered; });
		
	  g.transition()
	      .duration(1000)
	      .attr("transform", "scale(" + k + ")translate(" + x + "," + y + ")")
	      .style("stroke-width", 1 / k + "px");

	}

	var tooltip;
	function tooltipName(text,pos){

		tooltip = d3.select("body")
		.append("div")
		.attr("class","alert-box alert")
		.style("position", "absolute")
		.style("z-index", "10")
		.style("visibility", "hidden")
		.text(text);
	}
	

}


  </script>



</body>
</html>
